<!DOCTYPE html>
<html>
<style>
.line {
	fill: none;
	stroke-width: 1px;
}
</style>
<!-- load the d3.js library -->   
<script src='https://d3js.org/d3.v5.min.js'></script>
<head>

	<title> Stock Historical Data over Time</title>
</head>
<body onload="init()">
	<h1>Growth of $10,000 as of July 17,2020</h1>
	<svg width=1200 height=1000>
	</svg>
	<div id='checkboxContainer'></div>
	<script>
		async function init() {
			const stockList = await d3.csv('Data/StockList.csv');


			stockList.forEach(function(stockId, index){
				var ticker = stockId.Ticker;
				var company = stockId.Company;
				
				var checkbox = document.createElement('input');
				checkbox.type = 'checkbox';
				checkbox.id = ticker;
				checkbox.name = 'showStock';
				checkbox.value = ticker;
				checkbox.checked = true;
				checkbox.onclick = "updateStockList()";

				var label = document.createElement('label');
				label.htmlFor = ticker;
				label.appendChild(document.createTextNode(company));

				var br = document.createElement('br');

				var container = document.getElementById('checkboxContainer');
				container.appendChild(checkbox);
				container.appendChild(label);
				container.appendChild(br);

			});
			console.log(document.getElementById('checkboxContainer'));
			
			//var newStockList2=[];
			function updateStockList() {
/*				var newStockList=[];
				stockList.forEach(function(stockId, index){
					var ticker = stockId.Ticker;
					if (document.getElementById(ticker).checked)
					{
						newStockList.push(stockId);
						newStockList2.push(stockId);
					}

				});
				console.log(newStockList);*/
				console.log(1);
			}
			//console.log(newStockList2);
			//console.log(stockList);
			var timeMin = new Date('07/19/2010');
			var timeMax = new Date('07/17/2020');
			var priceMin = 0;
			var priceMax = 800000;
			var width = 1000;
			var height = 900;

			//var xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, w]);
            var xScale = d3.scaleTime().domain([timeMin, timeMax]).range([0, width]);
			var yScale = d3.scaleLinear().domain([priceMin, priceMax]).range([height, 0]);

            var xAxis = d3.axisBottom(xScale);
            var yAxis = d3.axisLeft(yScale);

            d3.select("svg")
			  .append("g")
			  .attr("transform", "translate(100, 50)")
			  .style("font", "14px times")
			  .call(yAxis);
			d3.select("svg")
			  .append("g")
			  .attr("transform", "translate(100, 950)")
			  .style("font", "14px times")
			  .call(xAxis);

            var colors = ['DarkOrange','SkyBlue','Crimson','LawnGreen', 'magenta', 'BlueViolet', 'BurlyWood', 'Brown', 'DarkGreen', 'DarkSlateGrey','IndianRed','LawnGreen','LightSalmon'];
			stockList.forEach(function(stockId, index){
				var ticker = stockId.Ticker;
				var company = stockId.Company;
				console.log(stockId);
				console.log(index);
				// if (stockId.localCompare('tsla') == 0) {

				// }

				const data = d3.csv('Data/' + ticker + '.csv')
				.then(function(data){
					// console.log(data);
					dates = data.map(function(d) {
						return new Date(d.Date); });

					closes = data.map(function(d) {
						return Number.parseFloat(d.Close); });

					console.log(dates[dates.length - 1]);
					console.log(closes[closes.length - 1]);
					var line = d3.line()
					             .x(function(d) {return xScale(new Date(d.Date));})
					             .y(function(d) {return yScale(parseFloat(d.Close)/parseFloat(closes[closes.length - 1])*10000); });

					d3.select('svg')
			  		  .append('g')
			          .attr("transform", "translate(100, 50)")
			          .append("path")
			          .data([data])
			          .attr("d", line)
			          .attr("class", "line")
			          .attr("stroke", colors[index]);
				})
				.catch(function(){
					console.log("error loading file");

				});


			});
// 			const data_qqq = await d3.csv('Data/QQQ.csv');
// 			const data_spy = await d3.csv('Data/SPY.csv');
// 			const qqq_holdings = await d3.csv('Data/QQQHoldings.csv');
// 			//const data_qqq = await d3.csv("https://www.nasdaq.com/api/v1/historical/QQQ/etf/2010-07-19/2020-07-19");
// 			//dateString = data_qqq.map(function(d) {return d.Date; });
// 			dates_qqq = data_qqq.map(function(d) {return new Date(d.Date); });
// 			closes_qqq = data_qqq.map(function(d) {return Number.parseFloat(d.Close); });
// 			dates_spy = data_spy.map(function(d) {return new Date(d.Date); });
// 			closes_spy = data_spy.map(function(d) {return Number.parseFloat(d.Close); });
// 			ticker = qqq_holdings.map(function(d) {return d.Ticker;});
// 			company = qqq_holdings.map(function(d) {return d.Company});
// 			percent = qqq_holdings.map(function(d){return d.PercentOfFund;});
// 			// console.log(ticker);
// 			// console.log(company);
// 			// console.log(percent);
// 			// volume = data_qqq.map(function(d) {return parseInt(d.Volume);});
// 			// open = data_qqq.map(function(d) {return parseFloat(d.Open);});
// 			// High = data_qqq.map(function(d) {return parseFloat(d.High);});
// 			// Low = data_qqq.map(function(d) {return parseFloat(d.Low);});			
// 			// console.log(volume);
// 			// console.log(open);
// 			// console.log(High);
// 			// console.log(Low);
// 			 xMin = Math.min(Math.min.apply(null, dates_qqq), Math.min.apply(null, dates_spy));
// 			 xMax = Math.max(Math.max.apply(null, dates_qqq), Math.max.apply(null, dates_spy));
// 			 yMin = Math.min(Math.min.apply(null, closes_qqq), Math.min.apply(null, closes_spy));
// 			 yMax = Math.max(Math.max.apply(null, closes_qqq), Math.max.apply(null, closes_spy));
// 			// yMin2 = Math.min.apply(null, prices2);
// 			// yMax2 = Math.max.apply(null, prices2);

// 			// console.log(yMin);
// 			// console.log(yMax);
// 			// console.log(yMin2);
// 			// console.log(yMax2);
			
// 			// console.log(volume2);
// 			// console.log(volume3);

// 			width = 600;
// 			height = 600;

// 			//var xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, w]);
//             var xScale = d3.scaleTime().domain([xMin, xMax]).range([0, width]);
// 			var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height, 0]);

//             var xAxis = d3.axisBottom(xScale);
//             var yAxis = d3.axisLeft(yScale);

// 			var line = d3.line()
// 					     .x(function(d) {return xScale(new Date(d.Date));})
// 					     .y(function(d) {return yScale(parseFloat(d.Close)); });

// 			colors = ['DarkOrange','SkyBlue','Crimson','LawnGreen'];

// 			d3.select('svg')
// 			  .append('g')
// 			  .attr("transform", "translate(50, 50)")
// 			  .append("path")
// 			  .data([data_qqq])
// 			  .attr("d", line)
// 			  .attr("class", "line")
// 			  .attr("stroke", colors[0]);

// 			d3.select('svg')
// 			  .append('g')
// 			  .attr("transform", "translate(50, 50)")
// 			  .append("path")
// 			  .data([data_spy])
// 			  .attr("d", line)
// 			  .attr("class", "line")
// 			  .attr("stroke", colors[1]);

// 			d3.select("svg")
// 			  .append("g")
// 			  .attr("transform", "translate(50, 50)")
// 			  .style("font", "14px times")
// 			  .call(yAxis);
// 			d3.select("svg")
// 			  .append("g")
// 			  .attr("transform", "translate(50, 650)")
// 			  .style("font", "14px times")
// 			  .call(xAxis);
// 			/*marker = d3.select("svg")
// 			           .append("g")
// 			           .attr("transform", "translate(50,50)")
// 			           .selectAll("circle")
// 			           .data(data_qqq)
// 			           .enter()
// 			           .attr("class", "dot")
// 			           .attr("cx", function(d, i) {return i;})
// 			           .attr("cy", function(d, i) {return yScale(d.Close);})
// 			           .attr("r", 4)
// 			           .attr("fill", color);
// */
		}
	</script>
</body>
</html>
