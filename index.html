<!DOCTYPE html>
<html>
<style>
.line {
	fill: none;
	stroke: steelblue;
	stroke-width: 2px;
}
</style>
<!-- load the d3.js library -->   
<script src='https://d3js.org/d3.v5.min.js'></script>
<head>

	<title> Stock Historical Data over Time</title>
</head>
<body onload="init()">
	<h1>Stock Historical Data over Time</h1>
	<svg width=800 height=700>
	</svg>
	<script>
		async function init() {
			const data_qqq = await d3.csv('Data/QQQ.csv');
			const data_spy = await d3.csv('Data/SPY.csv');

			//const data_qqq = await d3.csv("https://www.nasdaq.com/api/v1/historical/QQQ/etf/2010-07-19/2020-07-19");
			//dateString = data_qqq.map(function(d) {return d.Date; });
			dates_qqq = data_qqq.map(function(d) {return new Date(d.Date); });
			closes_qqq = data_qqq.map(function(d) {return Number.parseFloat(d.Close); });
			dates_spy = data_spy.map(function(d) {return new Date(d.Date); });
			closes_spy = data_spy.map(function(d) {return Number.parseFloat(d.Close); });
			// volume = data_qqq.map(function(d) {return parseInt(d.Volume);});
			// open = data_qqq.map(function(d) {return parseFloat(d.Open);});
			// High = data_qqq.map(function(d) {return parseFloat(d.High);});
			// Low = data_qqq.map(function(d) {return parseFloat(d.Low);});			
			// console.log(volume);
			// console.log(open);
			// console.log(High);
			// console.log(Low);
			 xMin = Math.min(Math.min.apply(null, dates_qqq), Math.min.apply(null, dates_spy));
			 xMax = Math.max(Math.max.apply(null, dates_qqq), Math.max.apply(null, dates_spy));
			 yMin = Math.min(Math.min.apply(null, closes_qqq), Math.min.apply(null, closes_spy));
			 yMax = Math.max(Math.max.apply(null, closes_qqq), Math.max.apply(null, closes_spy));
			// yMin2 = Math.min.apply(null, prices2);
			// yMax2 = Math.max.apply(null, prices2);

			// console.log(yMin);
			// console.log(yMax);
			// console.log(yMin2);
			// console.log(yMax2);
			
			// console.log(volume2);
			// console.log(volume3);

			width = 600;
			height = 600;

			//var xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, w]);
            var xScale = d3.scaleTime().domain([xMin, xMax]).range([0, width]);
			var yScale = d3.scaleLinear().domain([yMin, yMax]).range([height, 0]);

            var xAxis = d3.axisBottom(xScale);
            var yAxis = d3.axisLeft(yScale);

			var line = d3.line()
					     .x(function(d) {return xScale(new Date(d.Date));})
					     .y(function(d) {return yScale(parseFloat(d.Close)); });

			d3.select('svg')
			  .append('g')
			  .attr("transform", "translate(50, 50)")
			  .append("path")
			  .data([data_qqq])
			  .attr("d", line)
			  .attr("class", "line");

			d3.select('svg')
			  .append('g')
			  .attr("transform", "translate(50, 50)")
			  .append("path")
			  .data([data_spy])
			  .attr("d", line)
			  .attr("class", "line");

			d3.select("svg")
			  .append("g")
			  .attr("transform", "translate(50, 50)")
			  .style("font", "14px times")
			  .call(yAxis);
			d3.select("svg")
			  .append("g")
			  .attr("transform", "translate(50, 650)")
			  .style("font", "14px times")
			  .call(xAxis);
			/*marker = d3.select("svg")
			           .append("g")
			           .attr("transform", "translate(50,50)")
			           .selectAll("circle")
			           .data(data_qqq)
			           .enter()
			           .attr("class", "dot")
			           .attr("cx", function(d, i) {return i;})
			           .attr("cy", function(d, i) {return yScale(d.Close);})
			           .attr("r", 4)
			           .attr("fill", color);
*/
		}
	</script>
</body>
</html>
