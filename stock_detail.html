<!DOCTYPE html>
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<head>
	<title id='pageTitle'></title>
</head>
<body onload = 'init()'>
	<h1 id='heading1'></h1>
	<div class = 'revenue'>
		<h2 id='revenueHeading'></h2>
	</div>
	<div style="display: none">
		<form id=stock_detail action="stock_detail.html" method="GET">
			<input type="" name="stock" id='stock_name'>
			<button type = 'submit'></button>
		</form>
	</div>
	<div class = 'sectors'>
		<h2 id='sectorsHeading'></h2>
	</div>

	<div class = 'countries'>
		<h2 id='counteriesHeading'></h2>
	</div>

	<script>
		function getQueryVariable(variable)
		{
			var query = window.location.search.substring(1);
			var vars = query.split('&');
			for (var i=0;i<vars.length;i++) {
				var pair = vars[i].split('=');
				if (pair[0] == variable)
				{
					return pair[1];
				}
			}
		}
		var margin = {
			top: 100,
			bottom: 100,
			left: 100,
			right: 100
		};
		async function init() {
			if (window.location.href.includes('?')) {
				stock = getQueryVariable('stock');
			}
			else {
				stock = 'FB';
			}
			const data = await d3.csv("Data/" + stock + '_Financials.csv');

			revenues = data.map(function(d, i){return parseInt(d.Revenue);});

/*			const dataSectors = await d3.csv("Data/" + stock + 'Sectors.csv');
			const dataCountries = await d3.csv("Data/" + stock + 'Countries.csv');
			document.getElementById("pageTitle").innerHTML = stock + " Details";
			document.getElementById("heading1").innerHTML = stock + " Details";*/
			document.getElementById('revenueHeading').innerHTML = stock + ' Revenue & Earnings:';
			document.getElementById('sectorsHeading').innerHTML = stock + ' Top 10 Sectors:';
			document.getElementById('counteriesHeading').innerHTML = stock+'Top 10 Countries';

			var colors = ['Green'];
			var timeMin = Math.min(new Date(data[0].Date), new Date(data[data.length-1].Date));
			var timeMax = Math.max(new Date(data[0].Date), new Date(data[data.length-1].Date));
			var xScale = d3.scaleTime().domain([timeMin, timeMax]).range([0, 800]);
			var revenueMin = 0;
			var revenueMax = Math.max.apply(null, revenues);
			var yScale = d3.scaleLinear().domain([revenueMin, revenueMax]).range([800, 0]);
			var xAxis = d3.axisBottom(xScale);
			var yAxis = d3.axisLeft(yScale);

			revenueSVG = d3.select('.revenue').append('svg').attr('width', 1000).attr('height', 1000);
			revenueSVG.append("g")
					.attr("class", 'xAxis')
		   			.attr("transform", "translate("+ margin.left +", " + (margin.top + 800) +")")
	  	   			.style("font", "14px times")
	  	   			.call(xAxis);


			revenueSVG.append("g")
					.attr('class', 'yAxis')
	  	   			.attr("transform", "translate("+ margin.left + ", "+ margin.top + ")")
	  	   			.style("font", "14px times")
		   			.call(yAxis);

			revenueSVG.append('g').attr('transform', 'translate(100, 100)').selectAll('rect').data(data).enter().append('rect').attr('width', 10).attr('height', function(d){return yScale(parseInt(d.Revenue));}).attr("x", function(d,i) {return xScale(new Date(d.Date));}).attr('y', yScale(0)).attr('fill', colors[0]);


		}
	</script>
</body>
</html>